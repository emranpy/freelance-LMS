<script src="/js/jquery.min.js"></script>

<script>
function submit_yaml()
{
    yaml_content = document.getElementById("yaml_content").value;
    password = document.getElementById("password").value;

    if (yaml_content.trim() == "")
        return false;

    result_div = document.getElementById("result");
    result_div.innerHTML = "<div class='notification is-warning'>Please wait while your YAML is being parsed...</div>";
    result_div.scrollIntoView();

    post_data = { "yaml_content": yaml_content, "password": password };

    $.post("/edit_course/{{ this_course }}",
        post_data,
        function(data, status){
            var json_data = JSON.parse(data);

            if (json_data.error == "")
            {
                var div_type = "is-success";
                var message1 = "Success!";
                var message2 = "The YAML was parsed successfully.";
                document.getElementById("course_title").innerHTML = json_data.title;
                document.getElementById("introduction").innerHTML = json_data.introduction;
            }
            else
            {
                var div_type = "is-danger";
                var message1 = "An error occurred.";
                var message2 = "<pre>" + json_data.error + "</pre>";
            }

            result_div.innerHTML = "<div class='notification " + div_type + "'><p><strong>" + message1 + "</strong></p>\n\n<p>" + message2 + "</pre></div>\n\n";
        });

    return false;
}
</script>

<section class="section section-padding-medium">
<div class="content is-medium">

<h2>
{% if course_exists %}
    Edit
{% else %}
    Create
{% end %}
{{ this_course }}
</h2>

<p><strong>Course title: </strong><div id="course_title">{{ this_course_title }}</div></p>

<p><strong>Introduction: </strong><div id="introduction">{{ introduction }}</div></p>

<p><strong>YAML:</strong></p>

<p><textarea class="textarea is-info is-normal is-medium is-fullwidth" placeholder="Type your YAML here" rows="15" id="yaml_content" style="font-family:monospace">{{ yaml_content }}</textarea></p>

<p><input id="password" class="input is-info is-normal is-medium" type="password" placeholder="Password" /></p>

<p><a class="button is-info is-large is-fullwidth" onclick='submit_yaml()'>Save</a></p>

<p><a href="/course/{{ this_course }}">Done editing</a></p>

<p><div id="result"></div></p>

</div>
</section>
