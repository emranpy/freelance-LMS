#! /bin/bash

set -o errexit

./build_back_ends

export PATH=$PATH:~/.local/bin

cd middle_layer

#uvicorn main:app --port 9798 --workers 1

Port=9798
pid=`ps ax | grep gunicorn | grep $Port | awk '{split($0,a," "); print a[1]}' | head -n 1`
if [ -z "$pid" ]; then
  echo "No gunicorn deamon on port $Port"
else
  kill $pid
  echo "Killed gunicorn deamon on port $Port"
fi

gunicorn main:app -b 127.0.0.1:9798 -w 1 -k uvicorn.workers.UvicornWorker
#nohup gunicorn main:app -b 127.0.0.1:9798 -w 1 -k uvicorn.workers.UvicornWorker &
