<link rel="stylesheet" href="/static/modal.css">

<h2 style="text-align: center;">Help Requests Dashboard</h2>

<h4>Help requests for {{ course_basics["title"] }}</h4>
<div id="filter_container">
    <input class="input is-info is-medium" id="filter_input" type="text" onkeyup="filterStatus()" placeholder="Search">
    <div class="select is-info">
        <select id="filter_status" onchange="filterStatus()" class="edit-select">
            <option selected disabled>Filter status</option>
            <option>All</option>
            <option>Approved</option>
            <option>Not approved</option>
        </select>
    </div>
</div>

<table class="table" id="request_table">
    <thead>
        <tr>
            <th>Student Name</th>
            <th>Assignment Title</th>
            <th>Problem Title</th>
            <th>Request</th>
            <th>Suggestion Made</th>
            <th>Approved</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
    {% if help_requests %}
        {% for request in help_requests %}
        <tr>
            <td>{{ request["name"] }}</td>
            <td>{{ request["assignment_title"] }}</td> 
            <td>{{ request["problem_title"] }}</td>
            <td><a href="/view_request/{{ course_basics['id'] }}/{{ request['assignment_id'] }}/{{ request['problem_id'] }}/{{ request['user_id'] }}" class="button is-small is-link">View Request</a></td>
            {% if request["suggestion"] %}
                <td>
                    <img src="/static/greencheck.png" alt="Completed" class="table-icon"/>
                </td>
            {% else %}
                <td>
                    <img src="/static/unchecked.png" alt="Not completed" class="table-icon"/>
                </td>
            {% end %}
            {% if request["approved"] %}
                <td>
                    <img src="/static/greencheck.png" alt="Completed" class="table-icon"/>
                </td>
            {% else %}
                <td>
                    <img src="/static/unchecked.png" alt="Not completed" class="table-icon"/>
                </td>
            {% end %}
            <form method="post" action="/delete_request/{{ course_basics['id'] }}/{{ request['assignment_id'] }}/{{ request['problem_id'] }}/{{ request['user_id'] }}">
            <td>
                <button type="submit">
                    <img src="/static/trashcan.png" alt="Delete exercise" height="25px" width="25px">
                </button>
            </td>
            </form>
        </tr>
        {% end %}
    {% end %}    
    </tbody>
</table>

<script>
    function filterStatus() {
        var input, select, filter, table, tr, td, i;
        input = document.getElementById("filter_input");
        select = document.getElementById("filter_status");

        filter = input.value.toUpperCase();
        status_filter = select.value.toUpperCase();

        table = document.getElementById("request_table");
        tr = table.getElementsByTagName("tr");

        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "";

            td = tr[i].getElementsByTagName("td")[5];
            if (td) {
                var icon = td.getElementsByTagName('img')[0].alt;
                if (status_filter == "APPROVED" && icon != "Completed") {
                    tr[i].style.display = "none";
                } 
                else if (status_filter == "NOT APPROVED" && icon != "Not completed") {
                    tr[i].style.display = "none";
                }
            }

            for (var j = 0; j < 3; j++) {
                cell = tr[i].getElementsByTagName("td")[j];
                if (cell) {
                    if (cell.innerHTML.toUpperCase().indexOf(filter) > -1) {
                        break;
                    } 
                }
                if (j == 2) {
                    tr[i].style.display = "none";
                }
            }       
        }
    }
</script>