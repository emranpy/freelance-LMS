{% if course_basics["exists"] %}
  {% if assignment_basics["exists"] %}
    <h2>Edit Assignment</h2>
  {% else %}
    <h2>Create Assignment</h2>
  {% end %}
{% end %}

{% if result %}
  {% if result.startswith("Error:") %}
    <p><div class='notification is-danger' style='background-color: #f4a582'><strong>{{ result }}</strong></div></p>
  {% else %}
    <p><div class='notification is-success' style='background-color: #80cdc1'><strong>{{ result }}</strong></div></p>
  {% end %}
{% end %}

{% if course_basics["exists"] %}
  <form method="post" action="/edit_assignment/{{ course_basics["id"]}}/{{ assignment_basics["id"] }}" />

  <p><strong>Title: </strong></p>
  <p><textarea name="title" class="textarea is-info is-normal is-medium" placeholder="Please specify a descriptive title for this assignment." rows="1" style="font-family:monospace" autofocus>{{ assignment_basics["title"] }}</textarea></p>

  <p><strong>Introduction: </strong><br />Please use <a href="https://www.markdownguide.org/basic-syntax/" target='_blank' rel='noopener noreferrer'>Markdown syntax</a> to write an introduction for this assignment.</p>
  <p><textarea name="introduction" class="textarea is-info is-normal is-medium is-fullwidth" placeholder="Please provide an introduction for this assignment." rows="8" style="font-family:monospace">{{ assignment_details["introduction"] }}</textarea></p>

  <p><strong>Start date: </strong><br />If a start date is specified, students will be unable to view this assignment before the start date and time.</p>
  <div class="select is-info">
    <select name="has_start_date" onchange="showStartOptions(this.value)" style="padding: 2px;">
      <option
        {% if not assignment_details["start_date"] %}
          selected
        {% end %}
      >None</option>
      <option
        {% if assignment_details["start_date"] %}
          selected
        {% end %}
      >Select</option>
    </select>
  </div>
  <input type="datetime-local" name="start_date" id="start_date"
  {% if assignment_details["start_date"] %}
    style="display: inline;"
  {% else %}
    style="display: none;"
  {% end %}
  value='{{ assignment_details["start_date"] }}'>

  <p><strong>Due date: </strong></p>
  <div class="select is-info">
    <select name="has_due_date" onchange="showDueOptions(this.value)" style="padding: 2px;">
      <option
        {% if not assignment_details["due_date"] %}
          selected
        {% end %}
      >None</option>
      <option
        {% if assignment_details["due_date"] %}
          selected
        {% end %}
      >Select</option>
    </select>
  </div>
  <input type="datetime-local" name="due_date" id="due_date"
  {% if assignment_details["due_date"] %}
    style="display: inline;"
  {% else %}
    style="display: none;"
  {% end %}
  value='{{ assignment_details["due_date"] }}'>

  <div id="allow_late"
  {% if assignment_details["due_date"] %}
    style="display: inline;"
  {% else %}
    style="display: none;"
  {% end %}>
    <p><strong>Allow late submissions: </strong>
      <div class="select is-info">
        <select name="allow_late" style="padding:2px;">
          {% if assignment_details["allow_late"] %}
            <option value="Yes" selected>Yes</option>
            <option value="No">No</option>
          {% else %}
            <option value="Yes">Yes</option>
            <option value="No" selected>No</option>
          {% end %}
        </select>
      </div>
    </p>
  </div>

  <div id="view_answer_late"
  {% if assignment_details["due_date"] %}
    style="display: inline;"
  {% else %}
    style="display: none;"
  {% end %}>
    <p><strong>Allow students to view answer code after due date has passed: </strong>
      <div class="select is-info">
        <select name="view_answer_late" style="padding:2px;">
          {% if assignment_details["view_answer_late"] %}
            <option value="Yes" selected>Yes</option>
            <option value="No">No</option>
          {% else %}
            <option value="Yes">Yes</option>
            <option value="No" selected>No</option>
          {% end %}
        </select>
      </div>
    </p>
  </div>
  
  <p><strong>Visible: </strong>
    <div class="select is-info">
      <select name="is_visible" style="padding:2px;">
        {% if assignment_basics["visible"] %}
          <option value="Yes" selected>Yes</option>
          <option value="No">No</option>
        {% else %}
          <option value="Yes">Yes</option>
          <option value="No" selected>No</option>
        {% end %}
      </select>
    </div>
  </p>

  <p><input type="submit" class="button is-info is-large is-fullwidth" value="Save" /></p>

  <p>
      {% if assignment_basics["exists"] %}
          <a href="/assignment/{{ course_basics["id"] }}/{{ assignment_basics["id"] }}">Done editing</a>
      {% end %}
  </p><br />
  </form>
{% else %}
  This course has not been created yet.
{% end %}
<br /><br />

<script>
  /*var calendars = bulmaCalendar.attach('[type="date"]', options);
  for(var i = 0; i < calendars.length; i++) {
	  calendars[i].on('select', date => {
		  console.log(date);
	  });
  }

  var element = document.querySelector('#due_date');
  if (element) {
	  element.bulmaCalendar.on('select', function(datepicker) {
		  console.log(datepicker.data.value());
	  });
  }*/

  function showStartOptions(on) {
    var start_date = document.getElementById("start_date");
    if (on == "Select") {
      start_date.style.display = "inline";
    }
    else {
      start_date.style.display = "none";
    }
  }

  function showDueOptions(on) {
    var due_date = document.getElementById("due_date");
    var allow_late = document.getElementById("allow_late");
    var view_answer_late = document.getElementById("view_answer_late");

    if (on == "Select") {
      due_date.style.display = "inline";
      allow_late.style.display = "inline";
      view_answer_late.style.display = "inline";
    }
    else {
      due_date.style.display = "none";
      allow_late.style.display = "none";
      view_answer_late.style.display = "none";
    }
  }
</script>