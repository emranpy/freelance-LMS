<form enctype='multipart/form-data' method="post" action="/edit_exercise/{{ course_basics['id'] }}/{{ assignment_basics['id'] }}/{{ exercise_basics['id'] }}" id="myForm" />
{% if exercise_basics["exists"] %}
    <div class="row-container">
        <h2>Edit exercise</h2>
        <p>
            {% if result %}
                <a href="#code-output" class="right-space">View code output</a>
            {% end %}
            <input type="submit" class="button is-dark" value="Save" />
            <button class="button is-white" onclick="location.href='/exercise/{{ course_basics["id"] }}/{{ assignment_basics["id"] }}/{{ exercise_basics["id"] }}'; return false;">Done</button>
            {% if prev_exercise %}
                <a class="button is-white" href="/edit_exercise/{{ course_basics['id'] }}/{{ assignment_basics['id'] }}/{{ prev_exercise['id'] }}">Previous exercise</a>
            {% end %}
            {% if next_exercise %}
                <a class="button is-white" href="/edit_exercise/{{ course_basics['id'] }}/{{ assignment_basics['id'] }}/{{ next_exercise['id'] }}">Next exercise</a>
            {% end %}
        </p>
    </div>
{% else %}
    <h2>Create exercise</h2>
{% end %}

{% if result %}
    {% if result.startswith("Error:") %}
        <p><div class="notification error-message"><strong>{{ result }}</strong></div></p>
    {% elif result.startswith("Code") %}
        <p><pre class="error-message">{{ result }}</pre></p>
    {% else %}
        <p><div class="notification success-message"><strong>{{ result }}</strong></div></p>
    {% end %}
{% end %}

{% if course_basics["exists"] %}
  {% if assignment_basics["exists"] %}

    <!-- Global JavaScript -->
    <script>
        // object for matching example code with back_end
        let exampleDict = {
          // Solution additional instructions
          free_response_solution_instructions:
            `For this type of exercise, your solution itself will be used as the expected output.`,
          any_response_solution_instructions:
            `For this type of exercise, you don't need to enter a solution.`,
          python_solution_instructions:
            ``,
          bash_solution_instructions:
            ``,
          python_script_solution_instructions:
            `For this type of exercise, write your solution in python. You will write the bash code that executes your python_script in Test code.`,
          r_solution_instructions:
            ``,

          // Test Code additional instructions
          python_test_code_instructions:
            ``,
          bash_test_code_instructions:
            ``,
          python_script_test_code_instructions:
            `Write a bash script to run your solution code (saved as 'code.py') using python and arguments.`,
          r_test_code_instructions:
            ``,

          // Pre-Execution Code additional instructions
          python_check_code_instructions:
            `Write your pre-execution code in python.`,
          bash_check_code_instructions:
            `Write your pre-execution code in bash.`,
          python_script_check_code_instructions:
            `Write your pre-execution code in bash.`,
          r_check_code_instructions:
            `Write your pre-execution code in R.`,

          // Back end specific Solution examples
          python_solution_example:
            `# Example code
            def welcome(statement):
            \tprint("Hello,", statement)
            \nwelcome("world!")`,
          bash_solution_example:
            `# Example code
            function welcome {
            \techo "Hello, $1"
            }
            \nwelcome "world!"`,
          python_script_solution_example:
            `# Example code
            import sys
            \nprint(sys.argv[1])
            `,
          r_solution_example:
            `# Example code
            welcome <- function(statement) {
            \tprint(paste("Hello", statement, sep=", "))
            }
            \nwelcome("world!")`,

          // Back end specific Test Code examples
          python_test_code_example:
            `# Example code
            welcome("user!")`,
          bash_test_code_example:
            `# Example code
            welcome "user!"`,
          python_script_test_code_example:
            `# Example code
            python code.py "Hello world!"`,
          r_test_code_example:
            `# Example code
            welcome("user!")`,

          // Back end specific Pre-Execution Code examples
          bash_check_example:
            `# Example code
            FIND='#'
            while read -r line;
            \tdo
            \tif grep -q "$FIND" <<< "$line"; then
            \t\techo "Error: $FIND operator not allowed in this exercise"
            \tfi
            done < code`,
          python_check_example:
            `# Example code
            with open("code") as student_code:
            \tfor line in student_code:
            \t\tif "len(" in line:
            \t\t\tprint("Error: len() function not permitted in this exercise")`,
          python_script_check_example:
            `# Example code
            FIND='#'
            while read -r line;
            \tdo
            \tif grep -q "$FIND" <<< "$line"; then
            \t\techo "Error: $FIND operator not allowed in this exercise"
            \tfi
            done < code`,
          r_check_example:
            `# Example code
            connection <- file("code")
            open(connection)
            line <- readLines(connection, n=1)
            search <- "len"
            \nwhile(length(line) > 0) {
            \tif (grepl(search, line)) {
            \t\tprint("Error: len() function not allowed in this exercise")
            \t}
            \n\tline <- readLines(connection, n=1)
            }
            \nclose(connection)`,
        }

        function updateBackEndOptions(back_end, output_type_to_select) {
            // Clear out existing options from the dropdown
            $("#output_types").empty();

            ot_select = document.getElementById("output_types");

            $.get('/back_end/' + back_end, function( data ) {
                var json_data = JSON.parse(data);

                var i;
                for (i = 0; i < Object.keys(json_data["output_types"]).length; i++) {
                    key = Object.keys(json_data["output_types"])[i];
                    description = json_data["output_types"][key];

                    var opt = document.createElement('option');
                    opt.style.width = "50px";
                    opt.innerHTML = description;
                    opt.value = key;

                    if (output_type_to_select == '') {
                        if (key == "txt")
                            opt.selected = true;
                    }
                    else {
                        if (key == output_type_to_select)
                            opt.selected = true;
                    }
                    ot_select.appendChild(opt);
                }

                answer_code_editor.getSession().setMode(json_data["code_completion_path"]);
                starter_code_editor.getSession().setMode(json_data["code_completion_path"]);
                test_code_editor.getSession().setMode(json_data["code_completion_path"]);
                check_code_editor.getSession().setMode(json_data["code_completion_path"]);
            });

            // load back_end specific instructions for solution, test_code, and pre-execution code
            let back_end_type = document.getElementById("back_end").value;
            if (exampleDict[back_end_type + "_solution_instructions"] != "")
              document.getElementById("solution_additional_instructions").innerHTML = "<hr><p><em>" + exampleDict[back_end_type + "_solution_instructions"] + "</em></p>"
            else
              document.getElementById("solution_additional_instructions").innerHTML = ""
            if (exampleDict[back_end_type + "_test_code_instructions"] != "")
              document.getElementById("test_code_additional_instructions").innerHTML = "<hr><p><em>" + exampleDict[back_end_type + "_test_code_instructions"] + "</em></p>"
            else
              document.getElementById("test_code_additional_instructions").innerHTML = ""
            if (exampleDict[back_end_type + "_check_code_instructions"] != "")
              document.getElementById("check_code_additional_instructions").innerHTML = "<hr><p><em>" + exampleDict[back_end_type + "_check_code_instructions"] + "</em></p>"
            else
              document.getElementById("check_code_additional_instructions").innerHTML = ""
        }

        ace.require("ace/ext/language_tools");
    </script>

        <div class="shadow-box">
            <div class="row-container bottom-space">
                <div class="a-title-container">
                    <p><strong>Title*: </strong></p>
                    <p><textarea name="title" class="textarea is-grey is-fullwidth monospace" placeholder="Please specify a descriptive title." rows="1" autofocus>{{ exercise_basics["title"] }}</textarea></p>
                </div>
                <div class="a-visible">
                    <p><strong>Visible: </strong>
                        <div class="select is-grey">
                            <select name="is_visible" class="edit-select">
                            {% if exercise_basics["visible"] %}
                                <option value="Yes" selected>Yes</option>
                                <option value="No">No</option>
                            {% else %}
                                <option value="Yes">Yes</option>
                                <option value="No" selected>No</option>
                            {% end %}
                            </select>
                        </div>
                    </p>
                </div>
            </div>

            <div class="front-row-container">
                <div class="a-visible">
                    <p><strong>Back end: </strong>
                        <label class="is-primary has-tooltip-multiline has-tooltip-right" data-tooltip="Choose the back end (programming language environment) that will be used to check the students' solution.">
                            <i class="far fa-question-circle"></i>
                        </label>
                        <div class="select is-grey">
                            <select name="back_end" id="back_end" onchange="updateBackEndOptions(this.value, '')" class="edit-select">
                            {% for back_end in back_ends %}
                                <option
                                {% if back_end == exercise_details["back_end"] %}
                                    selected
                                {% end %}
                                >{{ back_end }}</option>
                            {% end %}
                            </select>
                        </div>
                    </p>
                </div>

                <div>
                    <p><strong>Output type: </strong>
                        <div class="select is-grey">
                            <select name="output_type" id="output_types" class="edit-select">
                            </select>
                        </div>
                    </p>
                </div>
            </div>

            <div class="top-space">
                <p><strong>Instructions*: </strong><br />Please use <a href="https://www.markdownguide.org/basic-syntax/" target='_blank' rel='noopener noreferrer'>Markdown syntax</a> to write instructions for this exercise.</p>
                <p><div class="textarea is-grey is-fullwidth monospace" id="instructions" placeholder="Please provide instructions for this exercise." style="min-height: 400px" contenteditable="true">{{ exercise_details["instructions"] }}</div></p>
                <textarea name="instructions" id="instructions_text" class="invisible"></textarea>
            </div>

            <div class="row-container top-space">
                <div>
                    <p><strong>Enable pair programming for this exercise: </strong>
                        <div class="select is-grey">
                            <select id="enable_pair_programming" name="enable_pair_programming" class="edit-select">
                            {% if exercise_details["enable_pair_programming"] %}
                                <option value="Yes" selected>Yes</option>
                                <option value="No">No</option>
                            {% else %}
                                <option value="Yes">Yes</option>
                                <option value="No" selected>No</option>
                            {% end %}
                            </select>
                        </div>
                    </p>
                </div>
            </div>
        </div>

        <div class="shadow-box">
            <p><strong>Credit: </strong>
                <br />If anyone should be given credit for creating this exercise, please indicate that using <a href="https://www.markdownguide.org/basic-syntax/" target='_blank' rel='noopener noreferrer'>Markdown syntax.</a>
                <br />Please provide a link to the data source(s) if you obtained the dataset from someone else.
            </p>
            <textarea class="textarea is-grey is-fullwidth monospace" placeholder="Please write the credit statement here." rows="2" name="credit">{{ exercise_details["credit"] }}</textarea></p>

            <div id="file_upload">
                <p><strong>Data file(s): </strong>
                    <br />Optionally, you can upload data files that students will use on this exercise. To upload more than one, select multiple files in a single upload or click "Add another file". The maximum total file size is 10 megabytes across all files.
                </p>
                <div id="uploaded_files" class="uploaded-files"></div>
                <input id="file_container" name="file_container" style="display: none;"></input>
                <div id="data_file" class="file is-small has-name space-div">
                    <label class="file-label">
                        <input class="file-input" type="file" name="data" multiple>
                        <span class="file-cta">
                            <span class="file-icon">
                            <i class="fas fa-upload"></i>
                            </span>
                            <span class="file-label">Choose a file…</span>
                        </span>
                        <span class="file-name"></span>
                    </label>
                </div>
            </div>
            <div id="add_file">
                <a onclick="showAddFile()">Add another file</a>
            </div>
        </div>

        <div class="shadow-box">
            <div>
                <p><strong>Solution*: </strong></p>
                <p>Please specify a solution for this exercise. If it requires programming, the solution will be executed, and the output of your solution will be used as the expected output. Please note: If your solution changes after students have already submitted answers, any students' answers that were previously marked as correct will remain as correct, but only your most recent solution will appear when students view past submissions. This may be confusing to students, so use caution when changing the solution; consider creating a new exercise instead.</p>
                <p id="solution_additional_instructions"></p>
                <textarea name="answer_code" id="answer_code" placeholder="Please provide a solution." rows="10">{{ exercise_details["answer_code"] }}</textarea>
                <!-- https://stackoverflow.com/questions/50662513/ace-editor-how-to-move-changed-data-to-post-or-get -->
                <textarea name="answer_code_text" id="answer_code_text" class="invisible"></textarea>
            </div>

            <div class="button is-light bottom-space" id="example_solution_button" onclick="showExampleSolution()">
              Toggle Example Code
              <input type="checkbox" class="invisible" id="example_solution_checkbox">
            </div>

            <div id="code-output">
            {% if exercise_basics["exists"] %}
                <p><strong>Output:</strong><br />

                {% if exercise_details["expected_text_output"] != "" %}
                    <p><pre><code>{{ exercise_details["expected_text_output"] }}</code></pre></p>
                {% end %}

                {% if exercise_details["expected_image_output"] != "" %}
                    <p><figure class='img'><img src='data:image/jpg;base64,{{ exercise_details["expected_image_output"] }}' width='95%' /></figure></p>
                {% end %}
            {% end %}
            </div>

            <div>
                <p><strong>Show expected output: </strong>
                    <div class="select is-grey">
                        <select name="show_expected" class="edit-select">
                        {% if exercise_details["show_expected"] %}
                            <option value="Yes" selected>Yes</option>
                            <option value="No">No</option>
                        {% else %}
                            <option value="Yes">Yes</option>
                            <option value="No" selected>No</option>
                        {% end %}
                        </select>
                    </div>
                </p>
            </div>
        </div>

        <div class="shadow-box">
            <div>
                <p><strong>Starter code: </strong></p>
                <p>Starter code will be given to a student when they haven't made any submissions yet. They'll be able to add to this code in order to solve the exercise.</p>
                <p>
                    <textarea class="textarea is-fullwidth monospace" placeholder="Please provide starter code." rows="10" id="starter_code" name="starter_code">{% if exercise_details["starter_code"] %}{{ exercise_details["starter_code"] }}{% end %}</textarea>
                    <textarea name="starter_code_text" id="starter_code_text" class="invisible"></textarea>
                </p>
            </div>
        </div>

        <div class="shadow-box">
            <div>
                <p><strong>Test code: </strong></p>
                <p>Test code can be used to run one or more tests using the student's code. It helps test the integrity of their code rather than its ability to produce the expected output.</p>
                <p id="test_code_additional_instructions"></p>
                <p>
                    <textarea class="textarea is-fullwidth monospace" placeholder="Please provide test code." rows="10" id="test_code" name="test_code">{{ exercise_details["test_code"] }}</textarea>
                    <textarea name="test_code_text" id="test_code_text" class="invisible"></textarea>
                </p>
            </div>

            <div class="button is-light bottom-space" id="example_test_code_button" onclick="showExampleTestCode()">
              Toggle Example Code
              <input type="checkbox" class="invisible" id="example_test_code_checkbox">
            </div>

            <div>
                <p><strong>Show test code: </strong>
                    <div class="select is-grey">
                        <select name="show_test_code" class="edit-select">
                        {% if exercise_details["show_test_code"] %}
                            <option value="Yes" selected>Yes</option>
                            <option value="No">No</option>
                        {% else %}
                            <option value="Yes">Yes</option>
                            <option value="No" selected>No</option>
                        {% end %}
                        </select>
                    </div>
                </p>
            </div>
        </div>

        <div class="shadow-box">
            <div>
                <p><strong>Pre-execution logic:</strong></p>
                <p>In some cases, instructors wish to check certain aspects of a student's code before it is executed. For example, they may wish to verify that the student has not used certain functions, variable names, etc. If you wish to use this functionality, enter code in the box below. The student's code will be saved in a file called "code" in the current working directory. Your code must read this file and then check the student's code. If a problem is found, print a message to standard output. Otherwise, print nothing to standard output.</p>
                <p id="check_code_additional_instructions"></p>
                <p>
                    <textarea class="textarea is-fullwidth monospace" placeholder="Please provide checking code." rows="10" id="check_code" name="check_code">{{ exercise_details["check_code"] }}</textarea>
                    <textarea name="check_code_text" id="check_code_text" class="invisible"></textarea>
                </p>
            </div>

            <div class="button is-light bottom-space" id="example_check_code_button" onclick="showExamplePreExecution()">
              Toggle Example Code
              <input type="checkbox" class="invisible" id="example_check_code_checkbox">
            </div>
        </div>

        <!--block for showing code examples-->
        <div class="shadow-box">
            <div class="space-div">
                <p><strong>Hint:</strong><br />Please use <a href="https://www.markdownguide.org/basic-syntax/" target='_blank' rel='noopener noreferrer'>Markdown syntax</a> to write an <em>optional</em> hint for this exercise.</p>
                <p><textarea class="textarea is-grey is-fullwidth monospace" placeholder="Please write in Markdown." rows="3" name="hint">{{ exercise_details["hint"] }}</textarea></p>
            </div>

            <div class="bottom-space">
                <p><strong>Solution description:</strong><br />Please use <a href="https://www.markdownguide.org/basic-syntax/" target='_blank' rel='noopener noreferrer'>Markdown syntax</a> to write a tutorial that describes your solution to this exercise.</p>
                <p><textarea class="textarea is-grey is-fullwidth monospace" placeholder="Please write in Markdown." rows="5" name="answer_description">{{ exercise_details["answer_description"] }}</textarea></p>
            </div>

            <div class="row-container bottom-space">
                <div>
                    <p><strong>Allow students to view the instructor's solution after they pass the exercise: </strong>

                        <div class="select is-grey">
                            <select name="show_answer" class="edit-select" onchange="showStudentSubmissionsDiv(this.value)">
                            {% if exercise_details["show_answer"] %}
                                <option value="Yes" selected>Yes</option>
                                <option value="No">No</option>
                            {% else %}
                                <option value="Yes">Yes</option>
                                <option value="No" selected>No</option>
                            {% end %}
                            </select>
                        </div>
                    </p>
                </div>
            </div>

            <div class="row-container bottom-space">
                <div>
                    <p><strong>Allow students to see submissions from other students: </strong>
                        <div class="select is-grey">
                            <select name="show_student_submissions" id="show_student_submissions" class="edit-select">
                            {% if exercise_details["show_student_submissions"] %}
                                <option value="Yes" selected>Yes</option>
                                <option value="No">No</option>
                            {% else %}
                                <option value="Yes">Yes</option>
                                <option value="No" selected>No</option>
                            {% end %}
                            </select>
                        </div>
                    </p>
                </div>
            </div>

            <div class="row-container bottom-space">
                <div>
                    <p><strong>Maximum # of submissions:</strong></p>
                    <p>
                        <div class="select is-grey">
                            <select name="max_submissions" class="edit-select">
                            {% for i in range(101) %}
                                {% if i == 0 %}
                                    {% if exercise_details["max_submissions"] == i %}
                                        <option value="0" selected>Unlimited</option>
                                    {% else %}
                                        <option value="0">Unlimited</option>
                                    {% end %}
                                {% else %}
                                    {% if exercise_details["max_submissions"] == i %}
                                        <option selected>{{ i }}</option>
                                    {% else %}
                                        <option>{{ i }}</option>
                                    {% end %}
                                {% end %}
                            {% end %}
                            </select>
                        </div>
                    </p>
                </div>
            </div>
        </div>

        <p><input type="submit" class="button is-dark is-medium is-fullwidth" value="Save" /></p>

        <p>
        {% if exercise_basics["exists"] %}
            <a href="/exercise/{{ course_basics['id'] }}/{{ assignment_basics['id'] }}/{{ exercise_basics['id'] }}">Done</a> |
        {% end %}
            <a href="#top">Back to top</a>
        </p>
        <div class="invisible" id="save_code"></div>

        <!-- Code to modify page behavior at the end of loading -->
        <script>
            function saveCode() {
              var save_code = document.getElementById("save_code").innerHTML
              return save_code.replaceAll("&lt;", "<").replaceAll("&gt;", ">").replaceAll("&amp;", "&")
            }

            function showExampleSolution() {
                document.getElementById("example_solution_checkbox").checked = !(document.getElementById("example_solution_checkbox").checked);
                if (document.getElementById("example_solution_checkbox").checked == true) {
                  document.getElementById("example_solution_button").classList.remove("is-light");
                  document.getElementById("example_solution_button").classList.add("is-primary");
                  // save current code
                  document.getElementById("save_code").innerHTML = answer_code_editor.getValue();
                  // display example code
                  answer_code_editor.setValue(exampleDict[document.getElementById("back_end").value + '_solution_example']);
              } else {
                  document.getElementById("example_solution_button").classList.remove("is-primary");
                  document.getElementById("example_solution_button").classList.add("is-light");
                  answer_code_editor.setValue(saveCode())
              }
            }

            function showExampleTestCode() {
                document.getElementById("example_test_code_checkbox").checked = !(document.getElementById("example_test_code_checkbox").checked);
                if (document.getElementById("example_test_code_checkbox").checked == true) {
                  document.getElementById("example_solution_button").classList.remove("is-light");
                  document.getElementById("example_solution_button").classList.add("is-primary");
                  // save current code
                  document.getElementById("save_code").innerHTML = test_code_editor.getValue();
                  // display example code
                  test_code_editor.setValue(exampleDict[document.getElementById("back_end").value + '_test_code_example']);
              } else {
                  document.getElementById("example_solution_button").classList.remove("is-primary");
                  document.getElementById("example_solution_button").classList.add("is-light");
                  test_code_editor.setValue(saveCode())
              }
            }

            function showExamplePreExecution() {
                document.getElementById("example_check_code_checkbox").checked = !(document.getElementById("example_check_code_checkbox").checked);
                if (document.getElementById("example_check_code_checkbox").checked == true) {
                  document.getElementById("example_solution_button").classList.remove("is-light");
                  document.getElementById("example_solution_button").classList.add("is-primary");
                  // save current code
                  document.getElementById("save_code").innerHTML = check_code_editor.getValue();
                  // display example code
                  check_code_editor.setValue(exampleDict[document.getElementById("back_end").value + '_check_example']);
              } else {
                  document.getElementById("example_solution_button").classList.remove("is-primary");
                  document.getElementById("example_solution_button").classList.add("is-light");
                  check_code_editor.setValue(saveCode())
              }
            }

            var answer_code_editor = ace.edit("answer_code", {
                theme: "ace/theme/{{ user_info['ace_theme'] }}",
                autoScrollEditorIntoView: true,
                minLines: 10,
                maxLines: 25,
                fontSize: "12pt"
            });

            var starter_code_editor = ace.edit("starter_code", {
                theme: "ace/theme/{{ user_info['ace_theme'] }}",
                autoScrollEditorIntoView: true,
                minLines: 10,
                maxLines: 15,
                fontSize: "12pt"
            });

            var test_code_editor = ace.edit("test_code", {
                theme: "ace/theme/{{ user_info['ace_theme'] }}",
                autoScrollEditorIntoView: true,
                minLines: 10,
                maxLines: 15,
                fontSize: "12pt"
            });

            var check_code_editor = ace.edit("check_code", {
                theme: "ace/theme/{{ user_info['ace_theme'] }}",
                autoScrollEditorIntoView: true,
                minLines: 10,
                maxLines: 15,
                fontSize: "12pt"
            });

            updateBackEndOptions('{{ exercise_details["back_end"] }}', '{{ exercise_details["output_type"] }}');

            document.getElementById("myForm").onsubmit = function(evt) {
                document.getElementById("answer_code_text").value = answer_code_editor.getValue();
                document.getElementById("starter_code_text").value = starter_code_editor.getValue();
                document.getElementById("test_code_text").value = test_code_editor.getValue();
                document.getElementById("check_code_text").value = check_code_editor.getValue();
                document.getElementById("instructions_text").value = document.getElementById("instructions").innerHTML
            }

            var index = 1;

            function showAddFile() {
                var file_div = document.createElement("div");
                file_div.classList.add("file", "is-small", "has-name", "space-div");

                var file_label = document.createElement("label");
                file_label.className = "file-label";

                var file_input = document.createElement("input");
                file_input.className = "file-input";
                file_input.setAttribute("name", "data" + index);
                index += 1;
                file_input.type = "file";
                file_input.multiple = true;
                file_label.appendChild(file_input);

                var file_span = document.createElement("span");
                file_span.className = "file-cta";

                var icon_span = document.createElement("span");
                icon_span.className = "file-icon";
                var icon = document.createElement("i");
                icon.classList.add("fas", "fa-upload");
                icon_span.appendChild(icon);
                file_span.appendChild(icon_span);

                var label_span = document.createElement("span");
                label_span.className = "file-label";
                label_span.innerHTML = "Choose a file...";
                file_span.appendChild(label_span);
                file_label.appendChild(file_span);

                var name_span = document.createElement("span");
                name_span.className = "file-name";
                file_label.appendChild(name_span);

                file_div.appendChild(file_label);

                var file_upload_div = document.getElementById("file_upload");
                file_upload_div.appendChild(file_div);

                updateFiles();
            }

            const container = document.querySelector("#file_upload");

            {% if exercise_details["data_files"] != "" %}
                // add previously uploaded files to the page
                data_file_div = document.getElementById("data_file");
                data_file_div.style.display = "none";
                var uploaded_files = JSON.parse('{{ json_files }}');
                var file_container = document.getElementById("file_container");
                file_container.value = JSON.stringify(uploaded_files);

                upload_div = document.getElementById("uploaded_files");
                for (let i = 0; i < {{ len(exercise_details["data_files"]) }}; i++) {
                    var file_div = document.createElement("div");
                    file_div.setAttribute("class", "uploaded-file");
                    file_div.setAttribute("id", i);

                    var text = document.createElement("p");
                    text.setAttribute("class", "file-text");

                    // sort data files alphabetically by file name
                    var file_name = document.createTextNode({{ sorted(exercise_details["data_files"], key=str.lower) }}[i]);
                    text.appendChild(file_name);

                    var d_button = document.createElement("button");
                    d_button.classList.add("button", "is-small", "is-primary", "is-inverted");
                    d_button.textContent = "X";

                    d_button.addEventListener("click", function(event) {
                        event.preventDefault();
                        delete uploaded_files[{{ sorted(exercise_details["data_files"], key=str.lower) }}[i]];
                        file_container.value = JSON.stringify(uploaded_files);

                        var file_div_to_remove = document.getElementById(i);
                        file_div_to_remove.style.display = "none";
                    });

                    file_div.appendChild(text);
                    file_div.appendChild(d_button);
                    upload_div.appendChild(file_div);
                }
            {% end %}

            updateFiles();

            function updateFiles() {
                var files = container.querySelectorAll("div.file");

                files.forEach(function(file) {
                    var fileInput = file.querySelector("input");
                    var fileName = file.querySelector("span.file-name");

                    fileInput.onchange = () => {
                        if (fileInput.files.length == 1) {
                            fileName.textContent = fileInput.files[0].name;
                        }
                        else if (fileInput.files.length > 1) {
                            fileName.textContent = fileInput.files.length + " files";
                        }
                    }
                });
            }
        </script>
        <script src="/static/shared.js" type="text/javascript" charset="utf-8"></script>
        </form>
    {% else %}
        This assignment has not been created yet.
    {% end %}
{% else %}
    This course has not been created yet.
{% end %}
