<form method="post" action="/edit_course/{{ course_basics['id'] }}" id="courseForm">

{% if course_basics["exists"] %}
<div class="row-container">
    <h2>Edit course</h2>
    <p>
        <input type="submit" class="button is-dark" value="Save" />
        <button class="button is-white" onclick="location.href='/course/{{ course_basics["id"] }}'; return false;">Done</button>
    </p>
</div>
{% else %}
    <h2>Create course</h2>
{% end %}


{% if result %}
    {% if result.startswith("Error:") %}
        <p><div class="notification error-message"><strong>{{ result }}</strong></div></p>
    {% else %}
        <p><div class="notification success-message"><strong>{{ result }}</strong></div></p>
    {% end %}
{% end %}

<div class="shadow-box">
    <div class="row-container">
        <div class="a-title-container">
            <p><strong>Title*: </strong></p>
            <p><textarea name="title" class="textarea is-grey is-medium monospace" placeholder="Please specify a descriptive title for this course." rows="1" autofocus>{{ course_basics["title"] }}</textarea>
        </div>

        <div class="a-visible">
            <p><strong>Visible: </strong>
                <div class="select is-grey">
                    <select name="is_visible" class="edit-select">
                    {% if course_basics["visible"] %}
                        <option value="Yes" selected>Yes</option>
                        <option value="No">No</option>
                    {% else %}
                        <option value="Yes">Yes</option>
                        <option value="No" selected>No</option>
                    {% end %}
                    </select>
                </div>
            </p>
        </div>
    </div>

    <div class="top-space">
        <p><div class="textarea is-grey is-fullwidth monospace" id="introduction" placeholder="Please provide an introduction for this course." style="min-height: 400px" contenteditable="true">{{ course_details["introduction"] }}</div></p>
        <textarea name="introduction" id="introduction_text" class="invisible"></textarea>
    </div>
</div>

<div class="shadow-box">
    <p><strong>Passcode (optional): </strong><br/>Students will be required to enter this code in order to register for the course.</p>
    <p><textarea name="passcode" class="textarea is-grey is-medium is-fullwidth monospace" rows="1">{% if course_details["passcode"] %}{{ course_details["passcode"] }}{% end %}</textarea></p>
</div>

<p><input type="submit" class="button is-dark is-medium is-fullwidth" value="Save" /></p>

<p>
{% if course_basics["exists"] %}
    <a href="/course/{{ course_basics['id'] }}">Done</a>
{% end %}
</p>

</form>

<script>
  $('div[contenteditable]').bind('paste', function(e) {
    if (e.originalEvent.clipboardData.items[0].kind != "string") {
    	var data = e.originalEvent.clipboardData.items[0].getAsFile()
    	var elem = this;
    	var fr = new FileReader;

    	fr.onloadend = function() {
    	  var img = new Image;
    	  img.src = fr.result;
    	  img.onload = function() {
    		  $(elem).append(img);
    	  };
    	};

    	fr.readAsDataURL(data);
    	e.preventDefault();
    }
  });

  document.getElementById("courseForm").onsubmit = function(evt) {
      document.getElementById("introduction_text").value = document.getElementById("introduction").innerHTML
  }
</script>
